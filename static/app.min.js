document.body.classList.remove("nojs"),document.body.classList.add("js"),Object.defineProperty(document,"referrer",{get:function(){return"http://music.163.com"}}),$(()=>{var e=$("body"),t=location.protocol+"//"+location.host+"/",i=["","音樂數據解析失敗"],r=(document.getElementById("preview"),new Vue({el:"#app",data:{verified:e.data("verified"),error:"",src_url:"",rate:32e4,lyricMode:"origin",url:"",playerUrl:null,song:{},type:"song",songlist:[]},methods:{sign(e){e.preventDefault(),this.url="";var r=$("#sign",this.$el).serialize(),n=this.src_url;if(!/^\d+$/.test(n)){let e=n.match(/(?:\?id=|\/)(\d+)/);if(!(e&&e.length>0))return void(this.error="無效的 ID 或無法辨識的網址");n=e[1]}this.playerUrl=`${window.location.protocol}//${window.location.hostname}/?music_id=${n}&bitrate=${this.rate.toString().slice(0,3)}`;var o=n+"/"+this.rate;"song"==this.type?$.post("/sign/"+o,r,e=>{if(this.verified=e.verified,!e.verified)return this.error="請填寫驗證碼!",void s();if(e.errno)return void(this.error=i[e.errno]);let r=e.song.artist.map(e=>e.name).join(" / ");this.lyric=e.song.lyric,this.cp?this.cp.add({name:e.song.name,artist:r,src:t+o+"/"+e.sign,poster:e.song.album.picUrl,lyric:this.lyric.origin,sublyric:this.lyric.cht}):this.cp=new cplayer({element:document.getElementById("cplayer"),size:"110%",width:"100%",playlist:[{name:e.song.name,artist:r,src:t+o+"/"+e.sign,poster:e.song.album.picUrl,lyric:this.lyric.origin,sublyric:this.lyric.cht}]}),this.url=t+o+"/"+e.sign,this.song=e.song,this.album=e.song.album,this.error="",this.response=e,this.SongArtist=r}).fail(()=>{this.error="伺服器錯誤。"}):"songlist"==this.type&&$.post("/signList/"+o,r,e=>{if(this.verified=e.verified,!e.verified)return this.error="請填寫驗證碼!",void s();e.errno?this.error=i[e.errno]:this.songlist=e.tracks})},sel(e){let t=e.currentTarget;t.setSelectionRange(0,t.value.length)},selRate(e){let t=e.target;this.rate=parseInt(t.dataset.rate),document.getElementById("rateText").innerHTML=t.dataset.rate.slice(0,-3)+" kbps"},selType(e){this.type=e.target.dataset.type},addSong(e){e.preventDefault();let r=e.target,n=this.rate,o=r.dataset.songid+"/"+n,a=$("#sign",this.$el).serialize();$.post("/sign/"+o,a,e=>{if(this.verified=e.verified,!e.verified)return this.error="請填寫驗證碼!",void s();if(e.errno)return void(this.error=i[e.errno]);let r=e.song.artist.map(e=>e.name).join(" / ");this.cp?this.cp.add({name:e.song.name,artist:r,src:t+o+"/"+e.sign,poster:e.song.album.picUrl,lyric:e.song.lyric.origin,sublyric:e.song.lyric.cht}):this.cp=new cplayer({element:document.getElementById("cplayer"),size:"110%",width:"100%",playlist:[{name:e.song.name,artist:r,src:t+o+"/"+e.sign,poster:e.song.album.picUrl,lyric:e.song.lyric.origin,sublyric:e.song.lyric.cht}]})})},onInput(e){let t=e.target.value;t.match(/(?:playlist.+?)(\d+)/)?this.type="songlist":t.match(/(?:song.+?)(\d+)/)&&(this.type="song")}},created(){document.body.classList.add("vue"),this.verified||s()},mounted(){this.dropdownTriggered=!!this.dropdownTriggered||ts(".ts.dropdown:not(.basic)").dropdown(),getParamsFromURL()}}),null);function s(){if(window.grecaptcha)null!==r?grecaptcha.reset(r):r=grecaptcha.render("recaptcha",{sitekey:e.data("sitekey")});else{var t=document.createElement("script");t.src="https://www.google.com/recaptcha/api.js?onload=loadCaptcha&render=explicit",document.body.appendChild(t)}}function n(e){const t=new Clipboard(e);e.addEventListener("click",function(e){e.preventDefault()}),t.on("success",function(){Swal("成功","複製成功！","success")}).on("error",function(){var e="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?"長按":"右鍵";Swal("喔不","複製失敗，請"+e+"網址手動複製！","error")})}window.loadCaptcha=s,n(document.getElementById("copy")),n(document.getElementById("copy2"))});